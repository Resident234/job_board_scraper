# UserProfileScraper - –ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –û–ø–∏—Å–∞–Ω–∏–µ

`UserProfileScraper` - —ç—Ç–æ —Å–∫—Ä–∞–ø–µ—Ä –¥–ª—è —Å–±–æ—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ñ–∏–ª—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –¥—Ä—É–∑—å—è—Ö —Å career.habr.com.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- **–ò–º—è** - –ø–æ–ª–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ `<h1 class="page-title__title">`
- **–≠–∫—Å–ø–µ—Ä—Ç** - —Ñ–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è —Å—Ç–∞—Ç—É—Å–∞ —ç–∫—Å–ø–µ—Ä—Ç–∞ (`.user-page-sidebar__is-expert`)
- **–£—Ä–æ–≤–µ–Ω—å** - —É—Ä–æ–≤–µ–Ω—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°—Ç–∞—Ä—à–∏–π (Senior)", "–°—Ä–µ–¥–Ω–∏–π (Middle)")
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ —É—Ä–æ–≤–Ω—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Product manager | B2B SaaS ‚Ä¢ –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞")
- **–ó–∞—Ä–ø–ª–∞—Ç–∞** - –∂–µ–ª–∞–µ–º–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤ —Ä—É–±–ª—è—Ö (—Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ)



## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```xml
<!-- –í–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å —Å–∫—Ä–∞–ø–µ—Ä -->
<add key="UserProfile:Enabled" value="false" />

<!-- –¢–∞–π–º–∞—É—Ç HTTP-–∑–∞–ø—Ä–æ—Å–∞ (—Å–µ–∫—É–Ω–¥—ã) -->
<add key="UserProfile:TimeoutSeconds" value="60" />

<!-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö -->
<add key="UserProfile:EnableRetry" value="true" />

<!-- –ò–∑–º–µ—Ä–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ -->
<add key="UserProfile:EnableTrafficMeasuring" value="true" />

<!-- –†–µ–∂–∏–º –≤—ã–≤–æ–¥–∞: ConsoleOnly, FileOnly, Both -->
<add key="UserProfile:OutputMode" value="Both" />

<!-- –®–∞–±–ª–æ–Ω URL –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥—Ä—É–∑–µ–π -->
<add key="UserProfile:FriendsUrlTemplate" value="https://career.habr.com/{0}/friends" />
```

## –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å

–°–∫—Ä–∞–ø–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **—Ä–∞–∑ –≤ 30 –¥–Ω–µ–π** –∏ –æ–±—Ö–æ–¥–∏—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `habr_resumes` (–≥–¥–µ `code IS NOT NULL`).

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ habr_resumes (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è)

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è:

```sql
ALTER TABLE habr_resumes 
ADD COLUMN level_id INTEGER REFERENCES habr_levels(id),
ADD COLUMN info_tech TEXT,
ADD COLUMN salary INTEGER;
```

### –¢–∞–±–ª–∏—Ü–∞ habr_levels

–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —É—Ä–æ–≤–Ω–µ–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤:

```sql
CREATE TABLE habr_levels (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```



## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —É—Ä–æ–≤–Ω—é

```sql
SELECT r.code, r.title, l.title as level, r.salary
FROM habr_resumes r
JOIN habr_levels l ON r.level_id = l.id
WHERE l.title = '–°—Ç–∞—Ä—à–∏–π (Senior)'
ORDER BY r.salary DESC NULLS LAST;
```

### –¢–æ–ø —É—Ä–æ–≤–Ω–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
SELECT l.title, COUNT(r.id) as user_count
FROM habr_levels l
JOIN habr_resumes r ON l.id = r.level_id
GROUP BY l.title
ORDER BY user_count DESC;
```

### –°—Ä–µ–¥–Ω—è—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º

```sql
SELECT l.title, 
       AVG(r.salary) as avg_salary,
       MIN(r.salary) as min_salary,
       MAX(r.salary) as max_salary,
       COUNT(r.salary) as count
FROM habr_levels l
JOIN habr_resumes r ON l.id = r.level_id
WHERE r.salary IS NOT NULL
GROUP BY l.title
ORDER BY avg_salary DESC;
```



## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `habr_resumes` (WHERE code IS NOT NULL)
2. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –æ–±—Ö–æ–¥** –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   - –û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã `/friends`
   - –ü–∞—Ä—Å–∏–Ω–≥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**:
   - –£—Ä–æ–≤–µ–Ω—å ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ/–ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ `habr_levels`
   - –ü—Ä–æ—Ñ–∏–ª—å ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `habr_resumes` (COALESCE)

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ü–∞—Ä—Å–∏–Ω–≥ —É—Ä–æ–≤–Ω—è –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

–ò–∑ —ç–ª–µ–º–µ–Ω—Ç–∞ `.user-page-sidebar__meta` –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –≤—Å–µ `<span>` —ç–ª–µ–º–µ–Ω—Ç—ã:
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç** = —É—Ä–æ–≤–µ–Ω—å (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `habr_levels`)
- **–û—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã** = —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ " ‚Ä¢ ")

–ü—Ä–∏–º–µ—Ä:
```
Input: "Product manager | B2B SaaS ‚Ä¢ –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞ ‚Ä¢ –°—Ç–∞—Ä—à–∏–π (Senior)"
Level: "–°—Ç–∞—Ä—à–∏–π (Senior)"
Info Tech: "Product manager | B2B SaaS ‚Ä¢ –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞"
```

### –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞—Ä–ø–ª–∞—Ç—ã

–ò–∑ —Ç–µ–∫—Å—Ç–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ:
```
Input: "–û—Ç 350 000 ‚ÇΩ ‚Ä¢ –ù–µ –∏—â—É —Ä–∞–±–æ—Ç—É"
Salary: 350000
```

–†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: `–û—Ç\s+([\d\s]+)\s*‚ÇΩ`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ NULL –∑–Ω–∞—á–µ–Ω–∏–π

–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `COALESCE` - —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å–ª–∏ –Ω–æ–≤—ã–µ NULL.

### –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

–ú–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ **500 –º—Å** –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# 1. –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —É—Ä–æ–≤–Ω–µ–π
psql -U postgres -d jobs -f sql/create_levels_table.sql

# 2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É resumes
psql -U postgres -d jobs -f sql/add_user_profile_columns.sql
```

## –û—Ç–ª–∞–¥–∫–∞

HTML –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤:
```
./logs/UserProfileScraper/last_page.html
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```
[UserProfileScraper] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: nikjalet -> https://career.habr.com/nikjalet/friends
[UserProfileScraper] HTML —Å–æ—Ö—Ä–∞–Ω—ë–Ω: ./logs/UserProfileScraper/last_page.html
[UserProfileScraper] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å nikjalet: –ò–º—è = –ù–∏–∫–∏—Ç–∞ –ö—Ä–∏—Ü–∫–∏–π, –≠–∫—Å–ø–µ—Ä—Ç = True, –£—Ä–æ–≤–µ–Ω—å = –°—Ç–∞—Ä—à–∏–π (Senior), –ó–∞—Ä–ø–ª–∞—Ç–∞ = 350000
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–°–∫–æ—Ä–æ—Å—Ç—å**: ~2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–µ–∫—É–Ω–¥—É (—Å —É—á–µ—Ç–æ–º –∑–∞–¥–µ—Ä–∂–∫–∏ 500 –º—Å)
- **–¢—Ä–∞—Ñ–∏–∫**: ~30-50 KB –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–í—Ä–µ–º—è –ø–æ–ª–Ω–æ–≥–æ –æ–±—Ö–æ–¥–∞**: –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î

–î–ª—è 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ~8-10 –º–∏–Ω—É—Ç

## –°–º. —Ç–∞–∫–∂–µ

- [JobBoardScraper README](../JobBoardScraper/README.md) - –æ—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [SQL README](../sql/README.md) - —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
