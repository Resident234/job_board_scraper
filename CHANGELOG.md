# Changelog

Все значимые изменения в проекте JobBoardScraper документируются в этом файле.

## [2.0.0] - 2024-11-04

### Добавлено

#### ExpertsScraper - новый скрапер для обхода экспертов
- Обход страниц экспертов с `https://career.habr.com/experts`
- Извлечение данных эксперта:
  - Имя и ссылка на профиль
  - Код пользователя из URL
  - Стаж работы (например, "9 лет и 9 месяцев")
  - Флаг эксперта (`expert = true`)
- Извлечение компаний из карточек экспертов
- Автоматическая пагинация
- Режим `UpdateIfExists` для обновления существующих записей
- Настраиваемый интервал обхода (по умолчанию: 4 дня)
- Поддержка всех режимов вывода (`ConsoleOnly`, `FileOnly`, `Both`)

#### Расширение структуры базы данных
- Новый столбец `code` - код пользователя из URL профиля
- Новый столбец `expert` - флаг эксперта (boolean)
- Новый столбец `work_experience` - стаж работы (text)
- Индексы для быстрого поиска по `code` и `expert`
- SQL-скрипт `add_expert_columns.sql` для миграции

#### SmartHttpClient - универсальная обёртка над HttpClient
- Объединяет функциональность `HttpRetry` и `TrafficMeasuringHttpClient`
- Автоматические повторы с экспоненциальной задержкой
- Измерение HTTP-трафика для каждого скрапера
- Настраиваемый timeout для каждого скрапера
- Поддержка заголовка `Retry-After`
- Индивидуальные настройки для каждого скрапера

#### Система измерения HTTP-трафика
- Класс `TrafficStatistics` для сбора статистики
- Автоматический подсчёт размера каждого HTTP-ответа
- Статистика по каждому скраперу отдельно
- Общая статистика по всем скраперам
- Сохранение в файл с настраиваемым интервалом (по умолчанию: 5 минут)
- Настройки в `App.config`:
  - `Traffic:OutputFile` - путь к файлу статистики
  - `Traffic:SaveIntervalMinutes` - интервал сохранения

#### Управление скраперами через конфигурацию
- Каждый скрапер можно включить/отключить через `App.config`
- Настройки `{Scraper}:Enabled` для всех скраперов:
  - `BruteForce:Enabled`
  - `ResumeList:Enabled`
  - `Companies:Enabled`
  - `Category:Enabled`
  - `CompanyFollowers:Enabled`
  - `Experts:Enabled`
- Вывод статуса каждого скрапера при запуске

#### Независимое логирование для каждого скрапера
- Класс `ConsoleLogger` для управления выводом
- Три режима вывода: `ConsoleOnly`, `FileOnly`, `Both`
- Отдельные лог-файлы для каждого скрапера
- Формат имени файла: `{ScraperName}_{timestamp}.log`
- Настройка режима через `App.config`:
  - `Companies:OutputMode`
  - `CompanyFollowers:OutputMode`
  - `Experts:OutputMode`

#### Документация
- `MIGRATION_GUIDE.md` - руководство по миграции с версии 1.x
- `QUICKSTART.md` - быстрый старт для новых пользователей
- `CHANGELOG.md` - история изменений
- Обновлён `README.md` с описанием ExpertsScraper
- Обновлён `sql/README.md` с примерами запросов для экспертов
- `docs/TRAFFIC_OPTIMIZATION.md` - оптимизация трафика

### Изменено

#### Рефакторинг системы логирования
- Удалён глобальный `Console.SetOut()`
- Каждый скрапер использует свой экземпляр `ConsoleLogger`
- Логи больше не смешиваются между скраперами
- Улучшена читаемость логов

#### Рефакторинг HTTP-клиентов
- Удалён класс `HttpRetry` (заменён на `SmartHttpClient`)
- Удалён класс `TrafficMeasuringHttpClient` (заменён на `SmartHttpClient`)
- Удалён класс `DualWriter` (заменён на `ConsoleLogger`)
- Все скраперы используют `SmartHttpClient`

#### Улучшение DatabaseClient
- Добавлена поддержка новых полей (`code`, `expert`, `work_experience`)
- Метод `EnqueueResume` принимает дополнительные параметры
- Метод `DatabaseInsert` поддерживает новые поля
- Улучшена обработка режима `UpdateIfExists`

#### Обновление Program.cs
- Инициализация `TrafficStatistics`
- Создание `SmartHttpClient` для каждого скрапера
- Вывод статуса каждого скрапера при запуске
- Добавлен ExpertsScraper в список процессов

### Удалено

- Класс `HttpRetry` (заменён на `SmartHttpClient`)
- Класс `TrafficMeasuringHttpClient` (заменён на `SmartHttpClient`)
- Класс `DualWriter` (заменён на `ConsoleLogger`)
- Глобальное перенаправление `Console.SetOut()`

### Исправлено

- Проблема смешанных логов от разных скраперов
- Дублирование кода HTTP-запросов
- Отсутствие контроля трафика
- Невозможность отключить отдельные скраперы
- Проблемы с кодировкой HTML (правильное определение из заголовков)

## [1.0.0] - 2024-10-29

### Добавлено

- Первоначальный релиз
- BruteForceUsernameScraper - перебор имён пользователей
- ResumeListPageScraper - обход списка резюме
- CompanyListScraper - обход списка компаний
- CategoryScraper - сбор категорий
- CompanyFollowersScraper - обход подписчиков компаний
- AdaptiveConcurrencyController - адаптивное управление параллелизмом
- DatabaseClient - работа с PostgreSQL
- Базовая система логирования
- Конфигурация через App.config

---

## Формат

Этот changelog следует принципам [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

### Типы изменений

- **Добавлено** - для новой функциональности
- **Изменено** - для изменений в существующей функциональности
- **Устарело** - для функциональности, которая скоро будет удалена
- **Удалено** - для удалённой функциональности
- **Исправлено** - для исправления багов
- **Безопасность** - для изменений, связанных с безопасностью
